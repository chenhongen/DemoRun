<!DOCTYPE html>
<html>
<head>
<title>CHE Studio</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="http://libs.baidu.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="css/demo.css" type="text/css" />
</head>
<body>

<div id="maincontainer">
    <div id="hamburgermenu">
        <nav id="tree" class="doc_menu well">
			<div class="author_img"></div>
			<div class="doc_menu_title">CHE Studio</div>
			<hr/>
			<ul>
				<li class="sub_menu opened">
					<a href="javascript:;">Github</a>
					<ul>
						<li>
							<a href="https://github.com/chenhongen">My Index</a>
						</li>
						<li>
							<a href="http://chenhongen.github.io/MergeCells/">MergeCell Demo</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="https://segmentfault.com/u/che/articles">SegmentFault</a>
				</li>
				<li class="sub_menu opened">
					<a href="javascript:;">Js Demo</a>
					<ul id="jsUlItem"> </ul>
				</li>
				<li class="sub_menu opened">
					<a href="javascript:;">Css Demo</a>
					<ul id="cssUlItem"> </ul>
				</li>
			</ul>
		</nav>
	</div>
	<div class="overlay"></div>

    <ul id="myTab" class="nav nav-tabs">
		<li class="menu">
			<p><span class="glyphicon glyphicon-th-list menubtn" ></span></p>
	    </li>
		<li class="active"><a href="#htmlTab" data-toggle="tab">HTML</a></li>
		<li><a href="#jsTab" data-toggle="tab">JavaScript</a></li>
		<li><a href="#cssTab" data-toggle="tab">CSS</a></li>
		<li><a href="#aboutTab" data-toggle="tab">About</a></li>
		<!--<li><button class="btn btn-default btn-success" type="submit" onclick="save()">Save</button></li>-->
		<div class="right_menu">
			<button class="btn btn-default btn-primary" type="submit" onclick="run()">&nbsp;Run&nbsp;</button>
			<button class="btn btn-default btn-info" type="submit" data-toggle="modal" data-target="#commModal">Comment</button>
		</div>
	</ul>
	<!-- iframe expand begin -->
	<span class="glyphicon glyphicon-resize-full expend-iframe" ></span>
	<!-- iframe expand end -->

	<div id="myTabContent" class="tab-content">
		<div id="htmlTab" class="tab-pane active">
			<pre id='htmlEditor'></pre>
		</div>
		<div id="jsTab" class="tab-pane">
			<pre id="jsEditor" > </pre>
		</div>
		<div id="cssTab" class="tab-pane">
			<pre id='cssEditor'> </pre>
		</div>
		<div id="aboutTab" class="tab-pane">
			<div class="tab-pane-div"><h3>Show your amazing code on the web!</h3>
			<p><b>Run button:</b> running your code in my webEditor.</p>
			<p><b>Comment button:</b> speaking out your opinions.</p>
			<p><b>Support browser:</b> Firefox|Chrome|Safari|IE?</p>
			<p><b>Contact me:</b> 251601797@qq.com</p>
			<p><b>My WeChat Public  && Donate:</b><hr/>
			<img src="image/rb.jpg" />
			<img src="image/donate.png" /><hr/>
			<p><b>Thanks for:</b> github|ace.js|duoshuo.com|and so on.</p></div>
		</div>
		<div id="resTab" class="">
			<iframe name="iframe" class="iframe" id="iframe" sandbox="allow-scripts allow-pointer-lock allow-same-origin allow-popups allow-forms" allowfullscreen="true" scrolling="yes" allowtransparency="true" name="iframe" frameborder="0" scr="iframe.html"></iframe>
		</div>
    </div>

	<!-- 模态框（Modal） -->
	<div class="modal fade" id="commModal" tabindex="-1" role="dialog" 
	   aria-labelledby="save your code" aria-hidden="true">
	   <div class="modal-dialog">
		  <div class="modal-content">
			 <div class="modal-header">
				<button type="button" class="close" 
				   data-dismiss="modal" aria-hidden="true">
					  &times;
				</button>
				<h4 class="modal-title" id="">
				   Say something...
				</h4>
			 </div>
			 <div class="modal-body" id="comment-box"  >
			 </div>
			 <!--<div class="modal-footer">
				<button type="button" class="btn btn-default" 
				   data-dismiss="modal">close
				</button>
			 </div> -->
		  </div><!-- /.modal-content -->
	</div><!-- /.modal -->

</div>	
</div>
<script src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="js/tab.js" type="text/javascript" charset="utf-8"></script>
<script src="js/modal.js" type="text/javascript" charset="utf-8"></script>
<script src="js/menu.js" type="text/javascript" charset="utf-8"></script>
<script src="js/util.js" type="text/javascript" charset="utf-8"></script>
<script src="js/confirm.js" type="text/javascript" charset="utf-8"></script>
<script src="build/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="http://pingjs.qq.com/h5/stats.js" name="MTAH5" sid="500052254"></script>
<script>var duoshuoQuery = {short_name:"rebey"};</script>
<script src="js/ds-embed.js"></script>
<script>
	
	// 网站域名
	var CNAME = "http://rebey.cn/";
	// bing comment article
	var article = "CSS loader";
	// ace编辑器初始化
    var htmlEditor = ace.edit("htmlEditor");
	htmlEditor.setTheme("ace/theme/monokai");
	htmlEditor.getSession().setMode("ace/mode/html");
	var cssEditor = ace.edit("cssEditor");
	cssEditor.setTheme("ace/theme/monokai");
	cssEditor.getSession().setMode("ace/mode/css");
	var jsEditor = ace.edit("jsEditor");
	jsEditor.setTheme("ace/theme/monokai");
	jsEditor.getSession().setMode("ace/mode/javascript");
	
	// 初始化：ace初始化；菜单初始化；
	$(function() {
		//使用getJSON方法读取json数据
		$.getJSON(CNAME+"post/CSS loader.json",function(data){
			htmlEditor.setValue(formatCodeIn(data.html));
			cssEditor.setValue(formatCodeIn(data.css));
			jsEditor.setValue(formatCodeIn(data.js));

			run();
		});

		$.getJSON(CNAME+"post/catalog.json",function(data){
			$.each(data.jsDemo, function(i, item) {
				addLiItem($("#jsUlItem"), item.name);
			});

			$.each(data.cssDemo, function(i, item) {
				addLiItem($("#cssUlItem"), item.name);
			});

			// 绑定文章切换事件
			$('.a_title').click(function(event){
				var target = event.srcElement || event.target;
				changeTo(target.text);
			});
		});

	});

	// tab事件绑定
	$('#myTab a').click(function (e) {
		e.preventDefault()
		$(this).tab('show')
	});

	// 运行代码
	function run() {
		var html = htmlEditor.getValue();
		var css = '<style>'+cssEditor.getValue()+'</style>';
		var js = '<script>'+jsEditor.getValue()+'</script'+'>';
		var ifr = document.getElementById('iframe');

		var win = ifr.window || ifr.contentWindow;
		win.document.getElementsByTagName('body')[0].innerHTML=(css+html);
		win.eval(jsEditor.getValue());

		//ifr.srcdoc = css+html+js; // 此方法IE失效
	}

	// json存储格式转换
	function save() {
		formatCodeOut(jsEditor.getValue());
		formatCodeOut(cssEditor.getValue());
		formatCodeOut(htmlEditor.getValue());
	}

	// 文章切换函数
	function changeTo(name) {
		article = name;
		$.getJSON("post/"+name+".json",function(data){
			htmlEditor.setValue(formatCodeIn(data.html));
			cssEditor.setValue(formatCodeIn(data.css));
			jsEditor.setValue(formatCodeIn(data.js));
			// 隐藏弹出菜单层
			$(".overlay").trigger("click");
			run();
		});
	}

	//documentation menu
	$('.sub_menu > a').mousedown(function () {
		$(this).parent().toggleClass('opened');
		$(window).trigger('resize');
		return false;
	})

	// expend iframe
	$('.expend-iframe').bind("click", function() {
		$(this).is(".glyphicon-resize-full")?$(".iframe").css({
			"width":"100%","transition":"all 0.4s linear","-webkit-transition":"all 0.4s linear"}):$(".iframe").css("width","50%");
		$(this).toggleClass("glyphicon-resize-full").toggleClass("glyphicon-resize-small");
	});

	// duoshuo
	$('#commModal').on('shown.bs.modal', function () {
		$("#comment-box").empty();
		var el = document.createElement('div');//该div不需要设置class="ds-thread"
		el.setAttribute('data-thread-key', article);//必选参数
		el.setAttribute('data-url', 'rebey.cn');//必选参数
		//el.setAttribute('data-author-key', '作者的本地用户ID');//可选参数
		DUOSHUO.EmbedThread(el);
		$("#comment-box").append(el);
		
	});

	/*$(".ds-post-button").bind("click", function() {
		po($("#ds-dialog-name"));
		$("#ds-dialog-name").enable();
	});*/

</script>
</body>
</html>